<!DOCTYPE html>
<html xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<title>Login Page</title>
	<link rel="stylesheet" href="/css/style.css">
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script src="/js/headerjs.js"></script>
	<script>
		myHeader();
	</script>
	<link rel="stylesheet" href="/css/style2.css">
	<link rel="stylesheet" href="/css/loginStyle.css">
	<script>
		function submitForm() {
			var id = $('#id').val();
			var password = $('#password').val();
			let token;
			console.log("")
			$.ajax({
				url: '/sign-api/sign-in',
				type: 'POST',

				data: {
					'id': id,
					'password': password,
					'token' : token
				},
				datatype: "json",
				success: function(data, status, xhr) {
					console.log('Success: ' + data);
					const jwt = xhr.getResponseHeader('X-AUTH-TOKEN');
					localStorage.setItem('X-AUTH-TOKEN', jwt);
					$.ajax({
						url: '/main', // mainPage를 요청하는 API endpoint 경로
						type: 'GET',
						headers: { 'X-AUTH-TOKEN': jwt }, // JWT 토큰을 헤더에 포함
						success: function(data) {
							window.location.href = '/main'
						},
						error: function(jqXHR, textStatus, errorThrown) {
							console.log('Error: ' + errorThrown);
						}
					});
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log('Error: ' + errorThrown);
				}
			})
		}

	</script>
</head>
<body>
<header>
	<include src="header.html"></include>
	<nav>
		<ul>
			<li><a href="/main">Home</a></li>
			<li><a href="/addProductPage">Shop</a></li>
			<li><a href="/cart">Cart</a></li>
			<li><a href="">Contact</a></li>
			<li>
				<a href="/sign-api/login" id="login-btn" sec:authorize="isAnonymous()">Login</a>
				<a href="" id="logout-btn" sec:authorize="isAuthenticated()">Logout</a>
			</li>
			<li><a href="/sign-api/register" id="register-btn">Sign up</a></li>
			<li><a href="/mypage" id ="mypage-btn">My Page</a></li>
		</ul>
	</nav>
</header>
<h1>Login Page</h1>
<form>
	<div>
		<label for="id">ID:</label>
		<input type="text" id="id" name="id">
	</div>
	<div>
		<label for="password">Password:</label>
		<input type="password" id="password" name="password">
	</div>
	<div>
		<button type="button" onclick="submitForm()">Login</button>
	</div>
</form>
</body>
</html>
